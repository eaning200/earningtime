<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Membership</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; color: #333; display: flex; flex-direction: column; align-items: center;}
        header { background-color: #333; color: white; padding: 1em 0; text-align: center; width: 100%;}
        nav { display: flex; justify-content: center; background-color: #444; padding: 0.5em; width: 100%;}
        nav a { color: white; margin: 0 15px; text-decoration: none; font-size: 1.1em;}
        nav a:hover { text-decoration: underline; }
        .container { width: 90%; max-width: 800px; margin: 20px auto; padding: 20px; background-color: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px;}
        h1, h2 { text-align: center; color: #333; }
        .vip-status { text-align: center; margin-bottom: 20px; padding: 15px; background-color: #e9f5ff; border: 1px solid #b3d7ff; border-radius: 5px;}
        .vip-status h3 { margin-top: 0; color: #0056b3;}
        .vip-status p { font-size: 1.1em; }
        .vip-levels { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;}
        .vip-level-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; background-color: #f9f9f9; }
        .vip-level-card h4 { margin-top: 0; color: #d9534f; }
        .vip-level-card.active { border-left: 5px solid #28a745; background-color: #e6ffed; }
        .claim-button { display: block; width: 200px; margin: 20px auto; padding: 12px; background-color: #28a745; color: white; border: none; border-radius: 5px; font-size: 1.1em; cursor: pointer; text-align: center; }
        .claim-button:disabled { background-color: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>


    <div class="container">
        <h2>VIP Levels & Benefits</h2>
        <div class="vip-status" id="vipStatusInfo">
            <h3>Your Current VIP Status</h3>
            <p>Level: <span id="currentVipLevel">Not VIP</span></p>
            <p>Daily Claim: <span id="dailyVipClaimAmount">0</span> TK</p>
            <p>Next Level Requirement: <span id="nextLevelRequirement">5 Direct Referrals for VIP 1</span></p>
            <button id="claimVipBonusButton" class="claim-button" disabled onclick="claimVipBonus()">Claim Daily Bonus</button>
        </div>

        <div class="vip-levels">
            <!-- VIP Level cards will be generated by JS -->
        </div>
    </div>

    <script>
        const vipTiers = [
            { level: 1, referralsNeeded: 5, dailyBonus: 25 },
            { level: 2, referralsNeeded: 10, dailyBonus: 60 },
            { level: 3, referralsNeeded: 15, dailyBonus: 100 },
            { level: 4, referralsNeeded: 25, dailyBonus: 150 },
            { level: 5, referralsNeeded: 30, dailyBonus: 200 },
            { level: 6, referralsNeeded: 40, dailyBonus: 300 },
            { level: 7, referralsNeeded: 50, dailyBonus: 500 }
        ];

        function getUserData() {
            const data = localStorage.getItem('userData');
            return data ? JSON.parse(data) : initializeUserData();
        }

        function saveUserData(userData) {
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        function initializeUserData() {
            const initialUserData = {
                balance: 0,
                referrals: { level1: 0, level2: 0, level3: 0, totalDirectReferrals: 0 },
                tasksCompletedToday: { date: new Date().toISOString().slice(0, 10), count: 0, completedIndices: [] },
                premiumTasksUnlocked: false,
                premiumTasksCompletedToday: { date: new Date().toISOString().slice(0, 10), count: 0, completedIndices: [] },
                vipLevel: 0,
                vipLastClaimDate: null,
                dailyLoginDates: [],
                totalRegularTasksCompleted: 0,
                withdrawalHistory: []
            };
            saveUserData(initialUserData);
            return initialUserData;
        }

        function determineVipLevel(directReferrals) {
            let currentLevel = 0;
            for (let i = vipTiers.length - 1; i >= 0; i--) {
                if (directReferrals >= vipTiers[i].referralsNeeded) {
                    currentLevel = vipTiers[i].level;
                    break;
                }
            }
            return currentLevel;
        }

        function updateVipDisplay() {
            const userData = getUserData();
            const directRefs = userData.referrals.totalDirectReferrals;
            
            // Auto-update VIP level based on referrals
            const newCalculatedVipLevel = determineVipLevel(directRefs);
            if (newCalculatedVipLevel !== userData.vipLevel) {
                userData.vipLevel = newCalculatedVipLevel;
                // If VIP level changes, reset last claim date to allow claiming for the new level (optional, depends on rules)
                // userData.vipLastClaimDate = null; 
                saveUserData(userData);
            }

            const currentLevel = userData.vipLevel;
            const vipStatusEl = document.getElementById('currentVipLevel');
            const dailyClaimEl = document.getElementById('dailyVipClaimAmount');
            const nextLevelReqEl = document.getElementById('nextLevelRequirement');
            const claimButton = document.getElementById('claimVipBonusButton');

            if (currentLevel > 0) {
                const currentTier = vipTiers.find(tier => tier.level === currentLevel);
                vipStatusEl.textContent = `VIP Level ${currentLevel}`;
                dailyClaimEl.textContent = `${currentTier.dailyBonus} TK`;

                const nextTier = vipTiers.find(tier => tier.level === currentLevel + 1);
                if (nextTier) {
                    nextLevelReqEl.textContent = `${nextTier.referralsNeeded - directRefs} more Direct Referrals for VIP ${nextTier.level}`;
                } else {
                    nextLevelReqEl.textContent = "You are at the highest VIP Level!";
                }

                const today = new Date().toISOString().slice(0, 10);
                if (userData.vipLastClaimDate === today) {
                    claimButton.textContent = "Claimed Today";
                    claimButton.disabled = true;
                } else {
                    claimButton.textContent = `Claim ${currentTier.dailyBonus} TK`;
                    claimButton.disabled = false;
                }
            } else {
                vipStatusEl.textContent = "Not VIP";
                dailyClaimEl.textContent = "0 TK";
                nextLevelReqEl.textContent = `${vipTiers[0].referralsNeeded - directRefs} more Direct Referrals for VIP 1`;
                claimButton.textContent = "Unlock VIP to Claim";
                claimButton.disabled = true;
            }

            renderVipLevelCards(userData);
        }

        function renderVipLevelCards(userData) {
            const vipLevelsContainer = document.querySelector('.vip-levels');
            vipLevelsContainer.innerHTML = ''; // Clear existing cards

            vipTiers.forEach(tier => {
                const card = document.createElement('div');
                card.classList.add('vip-level-card');
                if (userData.vipLevel === tier.level) {
                    card.classList.add('active');
                }
                
                let statusText = `Requires: ${tier.referralsNeeded} Direct Referrals`;
                if(userData.referrals.totalDirectReferrals >= tier.referralsNeeded) {
                    statusText = `<span style="color: green;">Unlocked</span> (You have ${userData.referrals.totalDirectReferrals} referrals)`;
                } else {
                     statusText = `Requires: ${tier.referralsNeeded} Direct Referrals (Need ${tier.referralsNeeded - userData.referrals.totalDirectReferrals} more)`;
                }


                card.innerHTML = `
                    <h4>VIP Level ${tier.level}</h4>
                    <p>Daily Bonus: ${tier.dailyBonus} TK</p>
                    <p>${statusText}</p>
                `;
                vipLevelsContainer.appendChild(card);
            });
        }

        function claimVipBonus() {
            const userData = getUserData();
            const today = new Date().toISOString().slice(0, 10);

            if (userData.vipLevel === 0) {
                alert("You are not a VIP member. Refer friends to become a VIP.");
                return;
            }
            if (userData.vipLastClaimDate === today) {
                alert("You have already claimed your VIP bonus for today.");
                return;
            }

            const currentTier = vipTiers.find(tier => tier.level === userData.vipLevel);
            if (currentTier) {
                userData.balance += currentTier.dailyBonus;
                userData.vipLastClaimDate = today;
                saveUserData(userData);
                alert(`Successfully claimed ${currentTier.dailyBonus} TK. Your new balance is ${userData.balance.toFixed(2)} TK.`);
                updateVipDisplay(); // Update button state
            } else {
                alert("Error: VIP tier not found.");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateVipDisplay();
        });
    </script>
</body>
</html>